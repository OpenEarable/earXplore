<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>earXplore - Add Study or Report Mistake</title>

  {# Style sheets #}
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/bootstrap.min.css') }}">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/add_study.css') }}">

  {# Scripts #}
  <script src="{{ url_for('static', filename='scripts/bootstrap.bundle.min.js') }}"></script>
  <script src="{{ url_for('static', filename='scripts/jQuery.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='scripts/add_study.js') }}"></script>

</head>
<body>
<div class="container" data-categories="{{ form_categories }}">
  <div class="header">
    <a href="https://open-earable.teco.edu/" target="_blank">
      <img src="{{ url_for('static', filename='images/OE_Logo_black_RGB.png')}}" alt="earXplore Logo">
    </a>
    <div>
      <h2 class="m-0"><a href="https://github.com/OpenEarable/earXplore/tree/master" target="_blank" style="text-decoration: none; color: inherit;">EarXplore</a></h2>
      <span class="text-muted" style="color: #B89491 !important;">Interaction</span>
    </div>
  </div>
  
  <a href="/" class="home-link mb-4">
    Back to EarXplore
  </a>
  
  <div class="row mb-4">
    <div class="col-md-6">
      <div id="reportMistakeCard" class="option-card h-100">
        <h4>Report a Mistake</h4>
        <p>Found an error or inconsistency in our database? Help us improve by reporting it.</p>
        <button id="reportMistakeBtn" class="btn btn-warning">Report Mistake</button>
      </div>
    </div>
    <div class="col-md-6">
      <div id="addStudyCard" class="option-card h-100">
        <h4>Add Your Study</h4>
        <p>Have you published a study on earable interactions that's not in our database? Submit your research for review and inclusion.</p>
        <button id="addStudyBtn" class="btn btn-warning">Add Study</button>
      </div>
    </div>
  </div>
  
  <!-- Report Mistake Form -->
  <div id="reportMistakeForm" class="form-section">
    <h4>Report a Mistake</h4>
    <p>Please provide details about the error you found in our database.</p>

    <form id="mistakeForm" action="{{ url_for('submit_mistake') }}" method="POST">
      <div class="mb-3">
        <label for="studyId" class="form-label">Study ID or Title (if known)</label>
        <input type="text" class="form-control" id="studyId" name="studyId" placeholder="e.g., 42 or 'EarGest: A Novel Ear Gesture Recognition System'">
      </div>
      <div class="mb-3">
        <label for="mistakeDescription" class="form-label">Description of Error*</label>
        <textarea class="form-control" id="mistakeDescription" name="description" rows="5" placeholder="Please describe the mistake in detail..." required></textarea>
      </div>
      <div class="mb-3">
        <label for="reporterEmail" class="form-label">Your Email (optional)</label>
        <input type="email" class="form-control" id="reporterEmail" name="email" placeholder="your.email@example.com">
        <div class="form-text">Provide your email if you'd like to receive updates about this report.</div>
      </div>
      <div class="d-flex justify-content-end">
        <button type="button" class="btn btn-secondary me-2 cancel-btn">Cancel</button>
        <button type="submit" class="btn btn-warning">Send Report</button>
      </div>
    </form>
  </div>
  
  <!-- Add Study Form -->
  <div id="addStudyForm" class="form-section">
    <h4>Add Your Study</h4>
    <p>Please provide information about your published research on earable interaction. You don't have to provide all the information on your study, although this will make the process of reviewing your study and adding it to the database much faster.</p>
    
    <form id="studyForm" action="{{ url_for('submit_study') }}" method="POST">
      <!-- Always include these essential fields -->
      <h5 class="section-header">Essential Information</h5>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="title" class="form-label">Title*</label>
          <input type="text" class="form-control" id="title" name="title" required>
        </div>
        <div class="col-md-6 mb-3">
          <label for="authors" class="form-label">Authors*</label>
          <input type="text" class="form-control" id="authors" name="authors" placeholder="e.g., Smith, J., Jones, A., etc." required>
        </div>
      </div>
        
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="venue" class="form-label">Published Venue*</label>
          <input type="text" class="form-control" id="venue" name="venue" placeholder="e.g., CHI, ISWC, etc." required>
        </div>
        <div class="col-md-6 mb-3">
          <label for="link" class="form-label">Link to Publication*</label>
          <input type="url" class="form-control" id="link" name="link" placeholder="https://..." required>
        </div>
      </div>
        
      <!-- Dynamically generate form sections based on categories -->
      {% if form_categories %}
        {% for panel_name, panel_data in form_categories.items() %}
          <h5 class="section-header">{{ panel_name }}</h5>
          {% for field_id, field in panel_data.items() %}
            {% if field.type == 'numeric' %}
              <div class="mb-3">
                  <label for="{{ field_id }}" class="form-label">{{ field.name }}</label>
                  <input type="number" class="form-control" id="{{ field_id }}" 
                          min="{{ field.min }}" max="{{ field.max }}" step="1">
              </div>
            {% elif field.type == 'checkbox' and field.options|length > 0 %}
              <div class="mb-3">
                <label class="form-label">{{ field.name }}</label>
                <div class="row">
                {% for option in field.options %}
                  <div class="col-md-4 mb-2">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" 
                              name="{{ field_id }}" value="{{ option }}" 
                              id="{{ field_id }}_{{ loop.index }}">
                      <label class="form-check-label" for="{{ field_id }}_{{ loop.index }}">
                        {{ option }}
                      </label>
                    </div>
                  </div>
                {% endfor %}
                    
                {% if field.options|length > 3 %}
                  <!-- Add "Other" option with text input field on the same line -->
                  <div class="col-md-12 mt-2">
                    <div class="d-flex align-items-center">
                      <label for="{{ field_id }}_other" class="me-2 mb-0">Other:</label>
                      <input type="text" class="form-control other-option-field" 
                              id="{{ field_id }}_other" 
                              placeholder="Please specify other options..."
                              data-field="{{ field_id }}">
                    </div>
                  </div>
                {% endif %}
                </div>
              </div>
            {% elif field.type == 'text' %}
              <div class="mb-3">
                <label for="{{ field_id }}" class="form-label">{{ field.name }}</label>
                <input type="text" class="form-control" id="{{ field_id }}">
              </div>
            {% endif %}
          {% endfor %}
        {% endfor %}
      {% else %}
        <!-- Fallback if categories couldn't be loaded -->
        <div class="alert alert-warning">
         Category options could not be loaded. Please fill in the basic information.
        </div>
      {% endif %}
      
      <!-- Always include these final fields -->
      <div class="mb-3">
        <label for="abstract" class="form-label">Abstract*</label>
        <textarea class="form-control" id="abstract" rows="4" required></textarea>
      </div>
      
      <div class="mb-3">
        <label for="keywords" class="form-label">Keywords</label>
        <input type="text" class="form-control" id="keywords" 
                placeholder="Enter keywords separated by commas">
      </div>
      
      <div class="mb-3">
        <label for="submitterEmail" class="form-label">Your Email*</label>
        <input type="email" class="form-control" id="submitterEmail" required>
      </div>
      
      <div class="mb-3">
        <label for="additionalInfo" class="form-label">Additional Information</label>
        <textarea class="form-control" id="additionalInfo" rows="3" 
                  placeholder="Any other details you'd like to share..."></textarea>
      </div>
      
      <div class="d-flex justify-content-end">
        <button type="button" class="btn btn-secondary me-2 cancel-btn">Cancel</button>
        <button type="submit" class="btn btn-warning">Submit Study</button>
      </div>
    </form>
  </div>
</div>
  
</body>
</html>
